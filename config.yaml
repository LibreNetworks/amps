# config.yaml
#
# Amps - Advanced Media Playlist Server Configuration

server:
  host: "0.0.0.0"
  port: 5000
  debug: false # Set to true for development, false for production

auth:
  enabled: false
  # Change this to a secure, randomly generated token for production
  token: "changeme123"

# List of media streams to serve
streams:
  - id: 1
    name: "Sintel (transcoded)"
    tvg_name: "Sintel HD"
    logo: "https://upload.wikimedia.org/wikipedia/commons/7/70/Sintel_poster.jpg"
    group: "Movies"
    channel_number: 101
    # Source: Creative Commons-licensed movie from Blender Foundation
    source: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4"
    ffmpeg_profile: "copy"
    description: "Behind-the-scenes footage from the Sintel short film."
    next_programs:
      - title: "Director Commentary"
        start: "2024-05-24T19:30:00Z"
        description: "Insights from the Sintel creative team."
      - title: "Making of Sintel"
        start: "2024-05-24T20:00:00Z"
    program_feed: "https://example.com/amps/sintel/schedule.json"

  - id: 2
    name: "Big Buck Bunny (copy)"
    logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Big_buck_bunny_poster_big.jpg/330px-Big_buck_bunny_poster_big.jpg"
    group: "Animation"
    # Source: HLS Test Stream
    source: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"
    ffmpeg_profile: "copy" # Remuxes the stream without transcoding

  - id: 3
    name: "DASH MPD Test"
    source: "http://d3rlna7iyyu8wu.cloudfront.net/DolbyVision_Atmos/profile8.1_DASH/p8.1.mpd"
    custom_ffmpeg:
      command: "ffmpeg -re -i {source} -c copy -metadata service_name='Dolby Atmos Demo' -f mpegts pipe:1"
      shell: false

  - id: 4
    name: "YouTube (yt-dlp)"
    source: "https://www.youtube.com/watch?v=aqz-KE-bpKQ"
    ffmpeg_profile: "copy"
    use_yt_dlp: true
    input_options:
      protocol_whitelist: "file,http,https,tcp,tls,crypto"

# Reusable FFmpeg command profiles. The options are passed to ffmpeg-python's .output() method.
ffmpeg_profiles:
  copy:
    vcodec: "copy"
    acodec: "copy"
    format: "mpegts"     # MPEG Transport Stream is required for streaming pipe output

  low_bitrate:
    vcodec: "libx264"
    preset: "fast"
    b:v: "800k"         # Video bitrate
    maxrate: "1000k"
    bufsize: "1500k"
    acodec: "aac"
    b:a: "128k"         # Audio bitrate
    format: "mpegts"

  h264_720p:
    vcodec: "libx264"
    preset: "medium"
    vf: "scale=-1:720"  # Scale to 720p height, maintaining aspect ratio
    b:v: "2500k"
    acodec: "aac"
    b:a: "192k"
    format: "mpegts"
